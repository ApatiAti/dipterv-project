<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="mainTemplate">
<head>
<meta charset="UTF-8" />
<title>Insert title here</title>
<!--/*-->
<link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="http://getbootstrap.com/examples/sticky-footer-navbar/sticky-footer-navbar.css" rel="stylesheet" />
<link href="http://getbootstrap.com/examples/theme/theme.css" rel="stylesheet" />
<!--*/-->
</head>
<body>
	<div class="page-header" layout:fragment="page_Header">
		<h3>JobOffers</h3>
	</div>

	<section layout:fragment="page-content">
<!-- 		<div class="panel panel-default"> -->
<!-- 			<div class="panel-heading"> -->
<!-- 				<h3 class="panel-title">JobOffer search</h3> -->
<!-- 			</div> -->
<!-- 			<div class="panel-body"> -->
<!-- 				<form action="#" th:action="@{/jobOffers/search}" th:object="${searchEntity}" method="post"> -->
<!-- 					<p>Region name</p> -->
<!-- 					<input th:field="*{name}"></input> -->
<!-- 					<p>Owner country</p> -->
<!-- 					<input th:field="*{country.name}" ></input> -->
<!-- 					<input type="submit" value="Search"></input> -->
<!-- 				</form> -->
<!-- 			</div> -->
<!-- 		</div> -->
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Active jobOffers</h3>
			</div>
			<div class="panel-body">
				
			<table id="jobOfferTable" class="col-sm-12 col-md-12 table table-striped" >
						<tr>
							<th>Company name</th>
							<th>Wage</th>
							<th>Begin date</th>
							<th>Amount</th>
							<th>Region</th>
							<th></th>
						</tr>
						<tr th:each="jobOffer : ${jobOfferList}" th:object="${jobOffer}" th:if="${not #lists.isEmpty(jobOfferList)}">
							<td id="comapnyName" th:text="*{company.name}">Test company</td>
							<td id="wage" th:text="*{wage}">20</td>
							<td id="beginDate" th:text="*{{beginDate}}">2015-01-25</td>
							<td id="amount" th:text="*{{amount}}">25</td>
							<td id="regionName" th:text="*{company.region.name}">Region 1</td>
							<td> 
								<button id="acceptJobOffer" class="btn btn-default btn-info" href="#" th:href="@{/jobOffers/accept/__*{id}__}"> Accept Job Offer</button>
							</td>
						</tr>
						<tr th:unless="${not #lists.isEmpty(jobOfferList)}">
							<td colspan="5" ><span> No job offer found</span></td>
						</tr>
				</table>
			</div>
		</div>	
	</section>


	<!--/*-->
	<!-- Bootstrap core JavaScript
	    ================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="#" th:src="@{/template_files/jquery.min.js}"></script>
	<script src="#" th:src="@{/template_files/bootstrap.min.js}"></script>
	<!--*/-->
	
	<section layout:fragment="scripts">
		<script>
			$(document).ready(function() {
				// TODO általánosítani				
				$("#jobOfferTable > tbody > tr > td > button").each(function(){
					 $(this).click(function(){
							var url = $(this).attr("href");
							
						 	$.ajax({
							 	context: this,
								type : 'post',
								url : url,
								dataType : 'json'
							}).done(function(data) {

								var tableRow = $(this).parent().parent();
								var amountCell = tableRow.find("#amount");
								var amount = amountCell.html();
								
								
								if (amount - 1 == 0){
	 								$(this).parent().parent().remove();
								} else {
									amountCell.html( amount - 1 );
								}

								putAlertBox("info","Info", data.content);
								
							}).fail(function(data) {
								var responseText = JSON.parse(data.responseText);
								putAlertBox("danger","Error", responseText.content);				
							});

					 })
					  
				});
				
			});
		</script>
	</section>
</body>
</html>